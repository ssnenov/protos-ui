(function(f,p,s){function n(a,b,d,c){a=f.extend(a,{author:b,widgetsName:c});b=new d(a);f.extend(b,g.widgets[c]);f.data(a.author[0],c,b);return b}var g=this.protos={},m=g.widgets={};f.fn.protos=function(){var a=this;return{popUp:function(b){return n(b,a,m.popUp,"popUp")},alertPopUp:function(b,d){"string"===typeof b?(d={},d.content=b):d=b;return n(d,a,m.alertPopUp,"alertPopUp")},swap:function(b){n(b,a,m.swap,"swap")},shake:function(b){return n(b,a,m.shake,"shake")},draggable:function(b){return n(b,
a,m.draggable,"draggable")},spa:function(b){return n(b,a,g.spa,"spa")},imageGallery:function(b){return n(b,a,m.imageGallery,"imageGallery")},listView:function(b){return n(b,a,m.listView,"listView")},scrollTo:function(b){return n(b,a,g.scrollTo,"scrollTo")}}};String.prototype.executeJavaScriptInTemplate=function(a){for(var b in a)window[b]=a[b];a=this;var d=a.indexOf("#");b=a.lastIndexOf("#");for(var c=a.length,e=d;e<=b;e++)if(e=a.indexOf("#",e),-1!==e){var e=e+1,f=a.indexOf("#",e),d=a.substr(e,f-
e);a=a.substr(0,e-2)+a.substr(f+2,c);e-=2;eval(d)}else break;return a};String.prototype.displayStringsTemplate=function(a){for(var b in a)window[b]=a[b];a=this;var d=a.indexOf("#=");b=a.lastIndexOf("#");for(var c=a.length;d<=b;d++)if(d=a.indexOf("#=",d),-1!==d){var d=d+2,e=a.indexOf("#",d),f=a.substr(d,e-d);a=a.substr(0,d-2)+eval(f)+a.substr(e+1,c);d-=2}else break;return a};String.prototype.format=function(){var a=this.match(/{[0-9]}/g),b=this,d;for(d in a)b=b.replace(a[d],arguments[d]);return b};
g.convertTemplateToString=function(a,b){var d=f(s+a),d=0!==d.length?d.html().displayStringsTemplate(b).executeJavaScriptInTemplate(b):a.displayStringsTemplate(b).executeJavaScriptInTemplate(b),c;for(c in b)delete window[c];return d};g.generateHTML=function(){var a=arguments,b={tag:a[0],classes:a[1],text:a[2],id:a[3],selfClosingTag:a[4],attributes:a[5]},b=f.extend({tag:"div",classes:[],text:"",id:""},b),d="",a=b.tag,d=d+("<"+a+" ");(function(){var a=b.id;d=a?d+('id="'+a+'" '):d+" "})();(function(){var a=
b.classes;0<a.length&&(d+='class="'+a.join(" ")+'"')})();(function(){var a=b.attributes,e;for(e in a)d+=e+'="'+a[e]+'" '})();b.selfClosingTag||(d+=">"+b.text);return d=!0===b.selfClosingTag?d+" />":d+("</"+a+">")};g.getElementOffset=function(a){for(var b=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,d+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:d,left:b}};g.template=function(a,b){this.render=function(){return g.convertTemplateToString(a,b)};return this};
var u=navigator.appName,v=navigator.platform,w=parseInt(v[v.length-1]),x=u[u.length-3],y=u[u.length-2];g.guid=function(){return"xxxxxxxx-sbkp-4xxx-yxxx-kxxxxxxxxxxx".replace(/[xysbkp]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:"s"===a?x:"k"===a?y:"p"===a?w:"b"===a?16*Math.random()|0:b&3|8).toString(16)})};g.queryStringToJson=function(a){var b={},d=a.indexOf("?");if(-1!==d){a=a.substr(d+1,a.length).split("&");for(var d=a.length,c=0;c<d;c++){var e=a[c].split("=");e[0]=decodeURIComponent(e[0]);
e[1]=decodeURIComponent(e[1]);"undefined"===typeof b[e[0]]?b[e[0]]=e[1]:"string"===typeof b[e[0]]?b[e[0]]=[b[e[0]],e[1]]:b[e[0]].push(e[1])}return b}};g.jsonToArray=function(a){var b=[],d;for(d in a)b.push(a[d]);return b};g.routeToArray=function(a){if(a){var b=[];a=a.substr(1,a.length).split("/");for(var d in a){var c=a[d];c?b.push(c):c}return b}};f.fn.serializeJson=function(){var a={},b=this.serializeArray();f.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),
a[this.name].push(this.value||"")):a[this.name]=this.value||""});return a};g.deferred=function(){var a=[],b=[],d=function(a,b){for(var d=0;d<a.length;d++)a[d].apply(void 0,b)},c=this;c.resolve=function(){d(a,Array.prototype.slice.call(arguments,0));return c};c.reject=function(){d(b,arguments);return c};c.done=function(b){a.push(b);return c};c.fail=function(a){b.push(a);return c}};g.deeplyDelete=function(a){for(var b in a)b instanceof Object&&this(a[b]),delete a[b]};g.qr=function(a,b,d){a="https://chart.googleapis.com/chart?cht=qr&chs={0}x{1}&chl={2}&chld={3}".format(b,
b,a,d||"L");b=new Image;b.src=a;return b};g.dataSource=function(a){a=a||{};var b=this,d,c=null,e;b.dataChanged=f.noop;b.localRepository=null;b.currentPageData=null;b._pageSize=15;var k=function(b,d,c){var e=typeof b,g=d;if("function"===e)b(d,c);else{var k={contentType:"application/json; charset=utf-8",dataType:"json",type:"GET",success:function(a){c.resolve(a,g)},error:function(a){c.reject(a,g)}};"string"===e?k.url=b:k=f.extend(k,b);a.prepareData&&(d=a.prepareData(d));"aspnet"===a.data.type&&(d="GET"===
k.type?f.param(d):JSON.stringify(d));k.data=d;f.ajax(k)}},q=function(){this.savedChanges=!1},l=function(a){for(var b=a.length-1;0<=b;--b){var d=a[b],c;for(c in d)d.watch(c,q);d.uid=g.guid();d.changed=!1;d.savedChanges=!0;d.deleted=!1}};b.read=function(h){var r=new g.deferred;r.fail(function(a){console.log(a)});r.done(function(a){e=h;a.Total?(c=a.Total,d=a.Data):d=a;l(d);b.localRepository=d;b.dataChanged(!0)});a.server&&a.server.paging&&(h=f.extend({Pagination:{Page:1,PageSize:b._pageSize}},h));k(a.data.read,
h,r);return r};b.itemsCount=function(){return null!==c?c:b.localRepository.length};b.update=function(){var c=new g.deferred,e=d.where(function(a){return!a.savedChanges}),f=a.data.update;c.done(function(a,d){for(var c=d.length-1;0<=c;--c)d[c].savedChanges=!0;b.dataChanged(!0)});if("function"===typeof f)return f(e,c),c;k(f,e,c);return c};b.create=function(c){var e=new g.deferred;e.done(function(a){!a instanceof Array&&(a=[a]);l(a);d=d.concat(a);b.refresh()});if(a.data.create)return k(a.data.create,
c,e),e;e.resolve(c)};b["delete"]=function(){var c=new g.deferred,e=function(a){return a.deleted};c.done(function(){b.refresh()});if(a.data["delete"])return k(a.data["delete"],d.where(e),c),c;d.remove(e);c.resolve()};b.getPageData=function(d,c,e){return a.server&&a.server.paging?e?b.currentPageData=b.localRepository:b.read({Pagination:{Page:d,PageSize:c}}):b.currentPageData=b.localRepository.skip((d-1)*c).take(c)};b.refresh=function(){var c=a.server;if(c&&(c.filtering||c.paging||c.sorting))return b.read(e),
b;b.localRepository=d;b.dataChanged(!0);return b};b.filter=function(d){if(a.server&&a.server.filtering)return b.read({Filters:d})};b.sort=function(){};b.findItem=function(a){return d.first(function(b){return b.uid==a})};return b};g.draggable=function(a){var b,d,c=f(a.author.selector),e;a.moveParent&&a.isParentDraggable&&(c=f(a.moveParent));e=f(a.moveParent);c.on("mousedown",function(k){function q(a,b,d){var c={};b&&f.extend(c,{left:b+"px"});d&&f.extend(c,{top:d+"px"});a.css(c)}b=k.clientX-g.getElementOffset(this).left;
d=k.clientY-g.getElementOffset(this).top;var l=a.container;if(l)f(p).on("mousemove",function(h){var k=h.clientX-b;h=h.clientY-d;var t=g.getElementOffset(f(l)[0]);l=f(a.container);if(t.left<k&&t.top<h){var z=g.getElementOffset(c[0]).left+c.outerWidth(),m=g.getElementOffset(c[0]).top+c.outerHeight(),n=t.left+l.outerWidth(),t=t.top+l.outerHeight(),p=n-c.outerWidth(),s=t-c.outerHeight()-1;z<=n?q(e,k,""):q(e,p,"");m<t-1?q(e,"",h):q(e,"",s)}});else f(p).on("mousemove",function(a){var c=a.clientX-b;a=a.clientY-
d;g.getElementOffset(f(l)[0]);q(e,c,a)});f(p).on("mouseup",function(){f(p).unbind("mousemove")})});return this};g.formFiller=function(a,b){a=f(a);a.find("textarea").each(function(a,c){f(c).val(b[c.name])});a.find("select").each(function(a,c){var e=b[c.name];f(c).val(e)});a.find("input[type=radio]").each(function(a,c){var e=b[c.name];f(c).attr("data-finished",!0);e&&c.value==e&&f(c).attr("checked","checked")});a.find("input[type=checkbox]").each(function(a,c){var e=b[c.name];f(c).attr("data-finished",
!0);e&&-1!==e.indexOf(c.value)&&f(c).attr("checked","checked")});a.find("input[data-finished!=true]").each(function(a,c){var e=b[c.name];e&&f(c).val(e)})};Array.prototype.where=function(a){for(var b=[],d=this.length,c=0;c<d;c++){var e=this[c];!0===a(e)&&b.push(e)}return b};Array.prototype.first=function(a){for(var b=this.length,d=0;d<b;d++){var c=this[d];if(!0===a(c))return c}};Array.prototype.sort=function(a){var b=this.length,d=Math.floor(b/2);if(2>b)return this;for(var c=this.slice(0,d).sort(a),
b=this.slice(d,b).sort(a),d=[];0<c.length||0<b.length;)0<c.length&&0<b.length?a(c[0],b[0])?(d.push(c[0]),c=c.slice(1)):(d.push(b[0]),b=b.slice(1)):0<c.length?(d.push(c[0]),c=c.slice(1)):0<b.length&&(d.push(b[0]),b=b.slice(1));return d};Array.prototype.last=function(a){for(var b=this.length,d,c=0;c<b;c++){var e=this[c];!0===a(e)&&(d=e)}return d};Array.prototype.any=function(a){for(var b=this.length,d=0;d<b;d++)if(!0===a(this[d]))return!0;return!1};Array.prototype.all=function(a){for(var b=this.length,
d=0;d<b;d++)a(this[d]);return this};Array.prototype.count=function(){return this.length-1};Array.prototype.skip||(Array.prototype.skip=function(a){if(this instanceof Array)return this.slice(a,this.length)});Array.prototype.take=function(a){if(this instanceof Array)return this.slice(0,a)};Array.prototype.remove=function(a){for(var b=this.length,d=0;d<b;d++)!0===a(this[d])&&this.splice(d,1)};g.lazyLoading=function(a){var b={container:f()};a=f.extend(b,a);f(p).scroll(function(){var b=f(window).scrollTop(),
c=f(p).height(),e=f(window).height();.95<b/(c-e)&&a.container.trigger("lazyLoad")})};m.listView=function(a){var b=this,d=a.author[0]||{},c=d.id+"_listItems",e=d.id+"pagerContainer";a=f.extend({width:600,height:400,imageWidth:200,pageSize:15,lazyLoading:!1},a);d.innerHTML=g.generateHTML("ul",[],"",c);f(d)[0].innerHTML+=g.generateHTML("div",[],"",e);b.dataSource=a.data;var k=function(){f(s+c+" li .itemEdit").each(function(b,c){f(c).on("click",function(){var b=f(this).closest(".listViewItem"),c=b.attr("data-uid"),
d=dataSource.findItem(c),e=b.data("popUp");e||(c=g.template(a.editTemplate).render(),c=g.generateHTML("form",[],c,"editForm"),b.protos().popUp({content:c,title:"Edit item",width:500,height:300}),e=b.data("popUp"));b.on("popUpShowed",function(){g.formFiller(f("#editForm"),d);f("#editForm").on("submit",function(a){a.preventDefault();a=f("#editForm").serializeJson();f.extend(d,a);e.hide();dataSource.update()})});e.show()})})};b.renderPage=function(){a.lazyLoading||f(s+c+" li").remove(".listViewItem");
for(var e="",l=b.dataSource.currentPageData,h=0;h<l.length;h++)var r=(new g.template(a.templateId,l[h])).render(),e=e+g.generateHTML("li",["listViewItem"],r,"",!1,{"data-uid":l[h].uid});f(s+c).append(e);f(d).trigger("pageRendered");k()};b.pager=new g.widgets.pager({pageSize:a.pageSize,dataSource:a.data,container:s+e,pageChanged:b.renderPage,lazyLoading:a.lazyLoading,nextPrevButtons:a.nextPrevButtons});a.data.read();return b};Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,
configurable:!0,writable:!1,value:function(a,b){var d=this[a],c=d,e=function(){return c},f=function(e){d=c;c=e;b.call(this,a,d,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}});Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a];this[a]=b}});m.pager=function(a){function b(){if(k){var b=a.dataSource.itemsCount(),c="",d=a.nextPrevButtons,b=Math.ceil(b/
a.pageSize);d?c+=g.generateHTML("li",["pageNumber"],"<"):c;for(var e=0;e<b;e++)var l=g.generateHTML("li",["pageNumber"],e+1),c=c+l;d?c+=g.generateHTML("li",["pageNumber"],">"):c;k[0].innerHTML=g.generateHTML("div",["pager"],g.generateHTML("ul",["pageList"],c));f(function(){f("li").on("click",k,function(){h(this.innerHTML)})})}}var d={pageSize:15,pageChanged:f.noop,nextPrevButtons:!0},c=this,e=1,k=f(a.container),q=a.dataSource;c.currentPage=function(){return parseInt(e)};a=f.extend(d,a);var l=function(b){b[0]&&
(f(a.container+" li").each(function(){this.innerHTML==e?f(this).addClass("selectedPage"):f(this).removeClass("selectedPage")}),k.trigger("pageChanged"),a.pageChanged())};c.changePage=function(b,c){new g.deferred;var d;e=b;d=q.getPageData(b,a.pageSize,c);d instanceof g.deferred?d.done(l):l(d)};c.refresh=function(a){b();c.changePage(e,a)};q.dataChanged=c.refresh;(function(){a.lazyLoading&&(f(k).on("lazyLoad",function(){c.nextPage()}),lazyLoading=new g.lazyLoading({container:k}));q._pageSize=a.pageSize})();
c.nextPage=function(){h("&rt;")};c.prevPage=function(){h("&lt;")};var h=function(b){var d=parseInt(b);isNaN(d)?"&lt;"===b?(e--,1<=e?c.changePage(e):e++):(e++,e<=Math.ceil(q.itemsCount()/a.pageSize)?c.changePage(e):e--):d!=e&&c.changePage(b)}};g.scrollTo=function(a){var b=a.author;a=a.speed||1E3;f(p.body).animate({scrollTop:g.getElementOffset(b[0]).top},a);return b};g.spa=function(a){var b=this;b.options=f.extend({},a);b.layout=b.options.author;b.routes=b.options.routes;b.startRouting=function(){d(window.location.hash);
if("onhashchange"in window)window.onhashchange=function(){d(window.location.hash)};else{var a=window.location.hash;window.setInterval(function(){window.location.hash!=a&&(a=window.location.hash,d(a))},100)}};b.stopRouting=function(){clearInterval(!0);window.onhashchange=f.noop};b.navigate=function(a){d("#"+a)};var d=function(a){for(var d in b.routes){var f=b.routes[d].route,l;1===a.indexOf("/")&&0===f.indexOf("/")?l=!1:l=!0;var h;h="#"+f;var r=a,m=l;if(h===r)h=!0;else{var n=h.match(RegExp(":[a-zA-Z0-9.\\-~_+%]+",
"g")),p=void 0;if(null===n)h=!1;else{p=m?g.jsonToArray(g.queryStringToJson(r)):g.routeToArray(r);m=void 0;for(m in n)h=h.replace(n[m],p[m]);h=h===r}}if(h){d=b.routes[d].action;if("undefined"!==typeof d&&"function"===typeof d)return a=l?g.queryStringToJson(a):g.routeToArray(a),d(a||{});if("undefined"===typeof d)return c(f);if("string"===typeof d)return c(d);break}}},c=function(a){f.ajax({url:a,type:"html",method:"get"}).done(function(a){b.layout.html(a)})};return b};m.shake=function(a){var b=this,
d=a.author,c=a.speed,e=-1*a.distance,f=a.vertical,g,l;d.on(a.event,function(){b.start()});b.start=function(){d.trigger("shakingStarts");g=setInterval(function(){d.css({"-webkit-transform":"translate("+(f?0:e)+"px, "+(f?e:0)+"px)"});e*=-1},100*c);l=setTimeout(function(){d.css({"-webkit-transform":"translate(0px, 0px)"});b.stop()},a.duration);return b};this.stop=function(){clearInterval(g);clearTimeout(l)};return b};m.swap=function(a){var b=a.author,d=f(a.element),c=this;b.on(a.event,function(){c.start()});
c.start=function(){b.trigger("swappingStarts");b.fadeOut(a.fadeOutSpeed);d.fadeIn(a.fadeInSpeed);setTimeout(function(){b.trigger("swappingEnds")},a.fadeOutSpeed+a.fadeInSpeed)};return c};m.alertPopUp=function(a){var b={width:380,height:120,author:f(p),widgetName:"alertPopUp",darkness:.3,title:"JavaScript Alert",draggable:!0};a=f.extend(b,a);a.content+=g.generateHTML("div",[],g.generateHTML("button",["protosOKbutton"],"Ok",!1),!1,{style:"padding-top: 15px; text-align: center;"});var b=new m.popUpCore(a),
d=a.author[0];b.hidePopUp=function(){f(".p-PopUp").remove();f(".p-darkLayer").remove();f.removeData(d,"alertPopUp")};f.data(d,"alertPopUp",b);f.data(d,"alertPopUp").show();f(".protosOKbutton").on("click",function(){f.data(d,"alertPopUp").hide()});return b};m.imageGallery=function(a){var b=this,d=0;b.images=a.images||[];b.dataSource=[];b.images instanceof g.dataSource&&(b.dataSource=b.images,b.images=b.dataSource.data);a=f.extend({width:1E3,height:500,darkness:.4,repeatImages:!0,images:[]},a);b.popUp=
f(a.author).protos().popUp(a);var c={style:"width: "+a.width/2+"px"};b.popUp.contentHtml=g.generateHTML("img",[],"","mainImage",!0,{style:"max-width: "+a.width+"px"})+g.generateHTML("div",[],"<b>></b>","nextImg",!1,c)+g.generateHTML("div",[],"<b><</b> ","prevImg",!1,c);var e=function(b){if(b){var c=b.url;f("#mainImage")[0].setAttribute("src",c);b.title?f(".p-popUpTitle").text(b.title):f(".p-popUpTitle").text(a.title)}};b.nextImage=function(){f(a.author[0]).trigger("nextImage");k(1);e(b.images[d]);
f(a.author[0]).trigger("imageChanged")};b.previousImage=function(){f(a.author[0]).trigger("previousImage");k(-1);e(b.images[d]);f(a.author[0]).trigger("imageChanged")};var k=function(c){var e=b.images.length-1;if(0>e)return!1;d+=c;if(d>e)return d=a.repeatImages?0:e,!1;if(0>d)return d=a.repeatImages?e:0,!1},m=b.popUp.show,l=b.popUp.hide;b.popUp.show=function(){m();e(b.images[0]);f("#nextImg").on("click",function(){b.nextImage()});f("#prevImg").on("click",function(){b.previousImage()});f("body").on("keydown",
function(a){37==a.keyCode&&b.previousImage();39==a.keyCode&&b.nextImage()})};b.popUp.hide=function(){l();f("#nextImg").off("click");f("#prevImg").off("click");f("body").off("keydown")};b.removeImages=function(){b.images=[]};b.addImages=function(a){a instanceof g.dataSource&&(b.images=a.data);if(0<a.length){for(var c in a)b.images.push(a[c]);e(b.images[0]);return b}"object"===typeof a&&b.images.push(a);e(b.images[0]);return b};b.changeImage=function(c){e(b.dataSource.findItem(c));f(a.author[0]).trigger("imageChanged")};
return b};m.popUpCore=function(a){var b=!1,d=g.generateHTML,c=this;c.author=f(a.author);c.darkLayerHtml=d("div",["p-darkLayer"],"","",!1,{style:"background-color: rgba(0,0,0,"+a.darkness+")"});c.contentHtml=d("div",["p-popUpContent"],a.content);c.titleHtml=d("div",["p-popUpTitle"],a.title);c.closePopUpButtonHtml='<a href="#">'+d("div",["p-closePopUpButton"],"X")+"</a>";c.body=f("body");(function(){c.author.on({showPopUp:function(){b||(popUpObject=c.addElements(a.darkness),c.addStyles(a,popUpObject),
e(c),b=!0,c.author.trigger("popUpShowed"))},hidePopUp:function(){f(".p-PopUp").remove();f(".p-darkLayer").remove();b=!1}})})();c.show=function(){c.author.trigger("showPopUp");c.body.on("keydown",function(a){27==a.keyCode&&c.hide()})};c.hide=function(){c.author.trigger("hidePopUp");c.body.off("keydown")};var e=function(){f("div.p-PopUp a").on("click",".p-closePopUpButton",function(){c.hide()});c.body.on("click",".p-darkLayer",function(){c.hide()})};c.addElements=function(){c.popUpHtml=g.generateHTML("div",
["p-PopUp"],c.closePopUpButtonHtml+c.addTitle()+c.contentHtml);c.body.append(c.darkLayerHtml);c.body.append(c.popUpHtml);c.makeTitleDraggable();return f(".p-PopUp","body")};c.addStyles=function(a,b){b.css({left:window.innerWidth/2-a.width/2+"px",top:window.innerHeight/2-a.height/2+"px",width:a.width+"px",height:a.height+"px",position:"fixed"});f(".p-popUpContent","div.p-PopUp").css({width:a.width+"px",height:a.height-50+"px","overflow-y":"auto","overflow-x":"auto"})};c.makeTitleDraggable=function(){a.title&&
!0===a.draggable&&n({moveParent:".p-PopUp",isParentDraggable:!0===a.isContentDraggable?!0:!1},f(".p-popUpTitle"),g.draggable,"draggable")};c.addTitle=function(){return a.title?c.titleHtml:""};return c};m.popUp=function(a){a=f.extend({width:500,height:300,darkness:.3,title:"Window",draggable:!0},a);return new m.popUpCore(a)}})(jQuery,document,"#");